knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(arrow)   # para guardar en formato Feather
# Leer el CSV (puedes cambiar a "auto_mpg_clean.csv" si así se llama en tu carpeta)
auto <- read.csv("auto-mpg_clean.csv",
stringsAsFactors = FALSE)
# Aseguramos que los encabezados sean los correctos
names(auto) <- c("mpg", "cylinders", "displacement", "horsepower",
"weight", "acceleration", "model_year", "origin",
"car_name")
glimpse(auto)
auto <- auto |>
mutate(
# horsepower numérico (por si viene como texto)
horsepower = as.numeric(horsepower),
# origin: 1,2,3 → USA, Europe, Japan
origin = factor(
origin,
levels = c(1, 2, 3),
labels = c("USA", "Europe", "Japan")
),
# car_name es texto tipo "chevrolet,chevelle,malibu"
# Extraemos la marca (todo antes de la primera coma)
brand = sub(",.*", "", car_name)
)
summary(select(auto, horsepower, origin, brand)[, 1:2])
head(select(auto, car_name, brand))
auto <- read.csv("auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto)
auto <- auto |>
mutate(
# Aseguramos que es texto
origin_raw = as.character(origin_raw),
# Código de origen = todo lo antes del tab
origin_code = sub("\\t.*", "", origin_raw),
# Nombre de coche = quitamos "numero + tab"
car_name = sub("^[0-9]+\\t", "", origin_raw),
# Convertimos origin_code a factor con las etiquetas correctas
origin = factor(
as.integer(origin_code),
levels = c(1, 2, 3),
labels = c("USA", "Europe", "Japan")
),
# horsepower numérica por si acaso
horsepower = as.numeric(horsepower)
) |>
# Nos quedamos con las columnas limpias y en orden bonito
select(mpg, cylinders, displacement, horsepower,
weight, acceleration, model_year, origin, car_name)
# Leer el CSV
auto <- read.csv("auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto)
# Aseguramos que los encabezados sean los correctos
names(auto) <- c("mpg", "cylinders", "displacement", "horsepower",
"weight", "acceleration", "model_year", "origin",
"car_name")
glimpse(auto)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(arrow)   # para guardar en formato Feather
# Leer el CSV tal como viene
auto_raw <- read.csv("auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto_raw)
# Leer el CSV tal como viene
auto_raw <- read.csv("auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto_raw)
# Aseguramos nombres coherentes para las primeras 8 columnas
names(auto_raw)[1:8] <- c("mpg", "cylinders", "displacement", "horsepower",
"weight", "acceleration", "model_year", "origin_raw")
# Creamos dataset limpio
auto <- auto_raw |>
mutate(
origin_raw = as.character(origin_raw),
# Código de origen: todo lo que está antes del tab
origin_code = sub("\\t.*", "", origin_raw),
# Nombre crudo: quitamos "numero + tab", queda "chevrolet,chevelle,malibu"
name_raw = sub("^[0-9]+\\t", "", origin_raw),
# Cambiamos comas por espacios y limpiamos espacios extra
name = gsub(",", " ", name_raw),
name = trimws(tolower(name)),
# Convertimos origin_code a factor con etiquetas minúsculas
origin = factor(
as.integer(origin_code),
levels = c(1, 2, 3),
labels = c("usa", "europe", "japan")
),
# Aseguramos tipos numéricos importantes
horsepower   = as.numeric(horsepower),
weight       = as.integer(weight),
cylinders    = as.integer(cylinders),
model_year   = as.integer(model_year),
displacement = as.numeric(displacement),
acceleration = as.numeric(acceleration),
mpg          = as.numeric(mpg)
) |>
# Nos quedamos con las columnas ya limpias y en orden final
select(mpg, cylinders, displacement, horsepower,
weight, acceleration, model_year, origin, name)
glimpse(auto)
head(auto)
auto_clean <- auto |>
drop_na(mpg, horsepower, weight, origin)
glimpse(auto_clean)
numeric_summary <- auto_clean |>
summarise(
across(
where(is.numeric),
list(
n      = ~ sum(!is.na(.)),
mean   = ~ mean(., na.rm = TRUE),
sd     = ~ sd(., na.rm = TRUE),
min    = ~ min(., na.rm = TRUE),
q1     = ~ quantile(., 0.25, na.rm = TRUE),
median = ~ median(., na.rm = TRUE),
q3     = ~ quantile(., 0.75, na.rm = TRUE),
max    = ~ max(., na.rm = TRUE)
),
.names = "{.col}_{.fn}"
)
)
numeric_summary
origin_counts <- auto_clean |>
count(origin) |>
mutate(prop = n / sum(n))
origin_counts
num_vars <- auto_clean |>
select(where(is.numeric))
cor_matrix <- cor(num_vars, use = "complete.obs")
cor_matrix
cor_mpg <- cor(num_vars, use = "complete.obs")[, "mpg"]
cor_mpg
mpg_por_origin <- auto_clean |>
group_by(origin) |>
summarise(
n        = n(),
mpg_mean = mean(mpg, na.rm = TRUE),
mpg_sd   = sd(mpg, na.rm = TRUE)
)
mpg_por_origin
ggplot(auto_clean, aes(x = origin, y = mpg, fill = origin)) +
geom_boxplot(alpha = 0.7) +
labs(
title = "Distribución de MPG por Origen",
x = "Origen",
y = "Eficiencia (mpg)"
) +
theme_minimal() +
theme(legend.position = "none")
ggplot(auto_clean, aes(x = weight, y = mpg, color = origin)) +
geom_point(alpha = 0.7) +
labs(
title = "Peso vs Eficiencia del Combustible",
x = "Peso",
y = "Eficiencia (mpg)",
color = "Origen"
) +
theme_minimal()
write_feather(auto_clean, "auto_mpg_clean_feather.feather")
list.files(pattern = "feather$")
# Leer el CSV tal como viene
auto_raw <- read.csv("data/auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto_raw)
# Leer el CSV tal como viene
auto_raw <- read.csv("data/auto-mpg_clean.csv",
stringsAsFactors = FALSE)
glimpse(auto_raw)
# Aseguramos nombres coherentes para las primeras 8 columnas
names(auto_raw)[1:8] <- c("mpg", "cylinders", "displacement", "horsepower",
"weight", "acceleration", "model_year", "origin_raw")
# Creamos dataset limpio
auto <- auto_raw |>
mutate(
origin_raw = as.character(origin_raw),
# Código de origen: todo lo que está antes del tab
origin_code = sub("\\t.*", "", origin_raw),
# Nombre crudo: quitamos "numero + tab", queda "chevrolet,chevelle,malibu"
name_raw = sub("^[0-9]+\\t", "", origin_raw),
# Cambiamos comas por espacios y limpiamos espacios extra
name = gsub(",", " ", name_raw),
name = trimws(tolower(name)),
# Convertimos origin_code a factor con etiquetas minúsculas
origin = factor(
as.integer(origin_code),
levels = c(1, 2, 3),
labels = c("usa", "europe", "japan")
),
# Aseguramos tipos numéricos importantes
horsepower   = as.numeric(horsepower),
weight       = as.integer(weight),
cylinders    = as.integer(cylinders),
model_year   = as.integer(model_year),
displacement = as.numeric(displacement),
acceleration = as.numeric(acceleration),
mpg          = as.numeric(mpg)
) |>
# Nos quedamos con las columnas ya limpias y en orden final
select(mpg, cylinders, displacement, horsepower,
weight, acceleration, model_year, origin, name)
glimpse(auto)
head(auto)
auto_clean <- auto |>
drop_na(mpg, horsepower, weight, origin)
glimpse(auto_clean)
numeric_summary <- auto_clean |>
summarise(
across(
where(is.numeric),
list(
n      = ~ sum(!is.na(.)),
mean   = ~ mean(., na.rm = TRUE),
sd     = ~ sd(., na.rm = TRUE),
min    = ~ min(., na.rm = TRUE),
q1     = ~ quantile(., 0.25, na.rm = TRUE),
median = ~ median(., na.rm = TRUE),
q3     = ~ quantile(., 0.75, na.rm = TRUE),
max    = ~ max(., na.rm = TRUE)
),
.names = "{.col}_{.fn}"
)
)
numeric_summary
origin_counts <- auto_clean |>
count(origin) |>
mutate(prop = n / sum(n))
origin_counts
num_vars <- auto_clean |>
select(where(is.numeric))
cor_matrix <- cor(num_vars, use = "complete.obs")
cor_matrix
cor_mpg <- cor(num_vars, use = "complete.obs")[, "mpg"]
cor_mpg
mpg_por_origin <- auto_clean |>
group_by(origin) |>
summarise(
n        = n(),
mpg_mean = mean(mpg, na.rm = TRUE),
mpg_sd   = sd(mpg, na.rm = TRUE)
)
mpg_por_origin
ggplot(auto_clean, aes(x = origin, y = mpg, fill = origin)) +
geom_boxplot(alpha = 0.7) +
labs(
title = "Distribución de MPG por Origen",
x = "Origen",
y = "Eficiencia (mpg)"
) +
theme_minimal() +
theme(legend.position = "none")
ggplot(auto_clean, aes(x = weight, y = mpg, color = origin)) +
geom_point(alpha = 0.7) +
labs(
title = "Peso vs Eficiencia del Combustible",
x = "Peso",
y = "Eficiencia (mpg)",
color = "Origen"
) +
theme_minimal()
write_feather(auto_clean, "data/auto_mpg_clean_feather.feather")
list.files(pattern = "feather$")
write_feather(auto_clean, "data/auto_mpg_clean_feather.feather")
list.files(pattern = "data/feather$")
